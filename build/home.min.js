var html=document.getElementsByTagName("html")[0],main=document.getElementsByTagName("main")[0],timetable=document.getElementsByClassName("timetable")[0],timetable_previous=document.getElementById("timetable_previous"),timetable_next=document.getElementById("timetable_next"),weeks=document.querySelectorAll(".timetable > div"),today_week=Array.prototype.slice.call(weeks).indexOf(timetable.getElementsByClassName("cur_week")[0]),cur_week=Array.prototype.slice.call(weeks).indexOf(timetable.getElementsByClassName("shown")[0]),days=document.querySelectorAll(".timetable > div > div"),lessons=document.querySelectorAll(".timetable > div > div ul li"),goto_today_buttons=timetable.getElementsByTagName("button"),details_block=document.getElementsByClassName("details")[0],details_lock=!1;function onResize(){timetable.style.height=weeks[cur_week].offsetHeight+"px"}function goto_day(e){html.classList.add("loaded"),cur_week=Array.prototype.slice.call(weeks).indexOf(timetable.getElementsByClassName(e)[0].parentNode.parentNode);for(let e of weeks)e.classList.remove("shown");weeks[cur_week].classList.add("shown"),timetable_previous.classList.toggle("hidden",cur_week<=0),timetable_next.classList.toggle("hidden",cur_week>=weeks.length-1),timetable.style.height=weeks[cur_week].offsetHeight+"px"}function goto_week(e){html.classList.add("loaded"),cur_week=e;for(let e of weeks)e.classList.remove("shown");weeks[cur_week].classList.add("shown"),timetable_previous.classList.toggle("hidden",cur_week<=0),timetable_next.classList.toggle("hidden",cur_week>=weeks.length-1),timetable.style.height=weeks[cur_week].offsetHeight+"px"}function show_details(e,t,s){details_lock||(locate_details(e,t),details_block.innerHTML=s.getElementsByTagName("div")[0].innerHTML,details_block.classList.toggle("cur_lesson",s.classList.contains("cur_lesson")),details_block.classList.toggle("vacation",s.classList.contains("vacation")),details_block.classList.add("shown"))}function locate_details(e,t){details_lock||(details_block.style.top=Math.min(document.documentElement.clientHeight-details_block.offsetHeight,t-html.scrollTop+20)+"px",details_block.style.left=Math.min(document.documentElement.clientWidth-details_block.offsetWidth,e-html.scrollLeft+20)+"px")}function hide_details(){details_lock||details_block.classList.remove("shown")}function toggle_details_lock(e){let t=!0;for(let s of lessons)if(s.contains(e.target)){details_lock=!1,show_details(e.pageX,e.pageY,s),details_lock=!0,t=!1;break}t&&!details_block.contains(e.target)&&(details_lock=!1,hide_details())}Event.add(window,"load",()=>{Event.add(window,"resize",onResize),setTimeout(onResize()),Event.add(timetable_previous,"mousedown",()=>{html.classList.add("loaded"),cur_week=Math.max(cur_week-1,0);for(let e of weeks)e.classList.remove("shown");weeks[cur_week].classList.add("shown"),timetable_previous.classList.toggle("hidden",cur_week<=0),timetable_next.classList.toggle("hidden",cur_week>=weeks.length-1),timetable.style.height=weeks[cur_week].offsetHeight+"px"}),Event.add(timetable_next,"mousedown",()=>{html.classList.add("loaded"),cur_week=Math.min(cur_week+1,weeks.length-1);for(let e of weeks)e.classList.remove("shown");weeks[cur_week].classList.add("shown"),timetable_previous.classList.toggle("hidden",cur_week<=0),timetable_next.classList.toggle("hidden",cur_week>=weeks.length-1),timetable.style.height=weeks[cur_week].offsetHeight+"px"});for(let e of goto_today_buttons)Event.add(e,"mousedown",()=>{goto_week(today_week)});for(let e of lessons){void 0!==e.getElementsByTagName("div")[0]&&(Event.add(e,"mouseenter",t=>{show_details(t.pageX,t.pageY,e)}),Event.add(e,"mouseleave",e=>{details_block.contains(e.relatedTarget)||hide_details()}),Event.add(e,"mousemove",e=>{locate_details(e.pageX,e.pageY)}))}Event.add(window,"mousedown",toggle_details_lock),Event.add(details_block,"mouseleave",hide_details)});